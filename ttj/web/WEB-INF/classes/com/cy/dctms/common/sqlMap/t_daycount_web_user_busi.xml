<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cy.dctms.dao.DaycountWebUserBusiDao">

    <insert id="insertDaycountWebUserBusi">
        insert into t_daycount_web_user_busi
        (record_day,web_user_id,no_confirm_orders,no_confirm_receives,no_assessment_orders,supply_releases,truck_orders,transactions)
        values
        <foreach collection="list" item="i" index="index" separator=",">
            (date_add(curdate(), interval -1 day),#{i.webUserId},#{i.noConfirmOrders},#{i.noConfirmReceives},#{i.noAssessmentOrders},#{i.supplyReleases},#{i.truckOrders},#{i.transactions})
        </foreach>
    </insert>

    <!-- 截至当天待确认订单数 -->
    <select id="queryNoConfirmOrders" resultType="int" parameterType="int">
        select count(ID) from t_transaction_info
        where ORDER_START = 1 and DEPLOY_USERID = #{webUserId}
        and CREATE_TIME  &lt; curdate()
    </select>
    <!-- 截至当天待确认收货数 -->
    <select id="queryNoConfirmReceives" resultType="int" parameterType="int">
        select count(ID) from t_transaction_info
        where ORDER_START = 3 and DEPLOY_USERID = #{webUserId}
        and MODIFY_TIME  &lt; curdate()
    </select>
    <!-- 截至当天待评价订单 -->
    <select id="queryNoAssessmentOrders" resultType="int" parameterType="int">
        select count(ID) from t_transaction_info where ORDER_START = 5 and DEPLOY_USERID = #{webUserId}
        and ID not in (select t1.USER_ID from t_user_driver_assess_info t1)
        and MODIFY_TIME  &lt; curdate()
    </select>
    <!-- 当天发布货源数 -->
    <select id="querySupplyReleases" resultType="int" parameterType="int">
        <![CDATA[
        select count(ID) from t_order_cargo_info where DEPLOY_USERID = #{webUserId}
        and CREATE_TIME >= date_add(curdate(), interval -1 day) and CREATE_TIME < curdate()
        ]]>
    </select>
    <!-- 当天订车数 -->
    <select id="queryTruckOrders" resultType="int" parameterType="int">
        <![CDATA[
        select count(ID) from t_transaction_info where DEPLOY_USERID = #{webUserId}
        and CREATE_TIME >= date_add(curdate(), interval -1 day) and CREATE_TIME < curdate()
        ]]>
    </select>
    <!-- 当天交易完成数 -->
    <select id="queryTransactions" resultType="int" parameterType="int">
        <![CDATA[
        select count(ID) from t_transaction_info where TRADE_START = 5 and DEPLOY_USERID = #{webUserId}
        and MODIFY_TIME >= date_add(curdate(), interval -1 day) and MODIFY_TIME < curdate()
        ]]>
    </select>
    <!-- 查询企业 -->
    <select id="queryCompanyList" resultType="int">
        <![CDATA[

        select  t1.DEPLOY_USERID as web_user_id from t_transaction_info t1
        where t1.DEPLOY_USERID <> 2 and t1.ORDER_START=1 and t1.CREATE_TIME < CURDATE()
        UNION
        select  t2.DEPLOY_USERID as web_user_id from t_transaction_info t2
        where t2.DEPLOY_USERID <> 2 and t2.ORDER_START = 3 and t2.MODIFY_TIME < CURDATE()
        UNION
        select  t3.DEPLOY_USERID as web_user_id from t_transaction_info t3
        where t3.DEPLOY_USERID <> 2 and t3.ORDER_START = 5 and t3.ID not in(select t4.USER_ID from t_user_driver_assess_info t4)
        and t3.MODIFY_TIME < CURDATE()
        UNION
        select  t5.DEPLOY_USERID as web_user_id from t_order_cargo_info t5
        where t5.DEPLOY_USERID <> 2
        and t5.CREATE_TIME >= date_add(curdate(), interval -1 day) and t5.CREATE_TIME < curdate()
        UNION
        select  t6.DEPLOY_USERID as web_user_id from t_transaction_info t6
        where  t6.DEPLOY_USERID <> 2
        and t6.CREATE_TIME >= date_add(curdate(), interval -1 day) and t6.CREATE_TIME < curdate()
        UNION
        select  t7.DEPLOY_USERID as web_user_id from t_transaction_info t7
        where t7.ORDER_START = 5 and t7.MODIFY_TIME >= date_add(curdate(), interval -1 day) and t7.MODIFY_TIME < curdate()

        ]]>
    </select>
</mapper>
