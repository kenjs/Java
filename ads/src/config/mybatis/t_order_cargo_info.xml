<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cy.driver.dao.OrderCargoInfoDao">
	<resultMap type="OrderCargoInfoDomain" id="OrderCargoInfoDomain">
		<result property="id" column="ID"/>
		<result property="startProvince" column="START_PROVINCE"/>
		<result property="startCity" column="START_CITY"/>
		<result property="startCounty" column="START_COUNTY"/>
		<result property="startTown" column="START_TOWN"/>
		<result property="endProvince" column="END_PROVINCE"/>
		<result property="endCity" column="END_CITY"/>
		<result property="endCounty" column="END_COUNTY"/>
		<result property="endTown" column="END_TOWN"/>
		<result property="cargoType" column="CARGO_TYPE"/>
		<result property="cargoName" column="CARGO_NAME"/>
		<result property="cargoCubage" column="CARGO_CUBAGE"/>
		<result property="cargoWeight" column="CARGO_WEIGHT"/>
		<result property="requestCarPlateType" column="REQUEST_CAR_PLATE_TYPE"/>
		<result property="requestCarLength" column="REQUEST_CAR_LENGTH"/>
		<result property="requestStartTime" column="REQUEST_START_TIME"/>
		<result property="contactMobilephone" column="CONTACT_MOBILEPHONE"/>
		<result property="contactTelephone" column="CONTACT_TELEPHONE"/>
	</resultMap>

	<resultMap type="OrderCargoInfoDomain" id="OrderCargoInfoDomainOther">
		<result property="id" column="ID"/>
		<result property="startProvince" column="START_PROVINCE"/>
		<result property="startCity" column="START_CITY"/>
		<result property="startCounty" column="START_COUNTY"/>
		<result property="startTown" column="START_TOWN"/>
		<result property="endProvince" column="END_PROVINCE"/>
		<result property="endCity" column="END_CITY"/>
		<result property="endCounty" column="END_COUNTY"/>
		<result property="endTown" column="END_TOWN"/>
		<result property="cargoType" column="CARGO_TYPE"/>
		<result property="cargoName" column="CARGO_NAME"/>
		<result property="cargoCubage" column="CARGO_CUBAGE"/>
		<result property="cargoWeight" column="CARGO_WEIGHT"/>
		<result property="requestCarPlateType" column="REQUEST_CAR_PLATE_TYPE"/>
		<result property="requestCarLength" column="REQUEST_CAR_LENGTH"/>
		<result property="requestStartTime" column="REQUEST_START_TIME"/>
		<result property="contactMobilephone" column="CONTACT_MOBILEPHONE"/>
		<result property="contactTelephone" column="CONTACT_TELEPHONE"/>
	</resultMap>

	<resultMap type="OrderCargoInfoDomain" id="OrderCargoInfoDomainDetail">
		<result property="id" column="ID"/>
		<result property="startProvince" column="START_PROVINCE"/>
		<result property="startCity" column="START_CITY"/>
		<result property="startCounty" column="START_COUNTY"/>
		<result property="startTown" column="START_TOWN"/>
		<result property="endProvince" column="END_PROVINCE"/>
		<result property="endCity" column="END_CITY"/>
		<result property="endCounty" column="END_COUNTY"/>
		<result property="endTown" column="END_TOWN"/>
		<result property="requestStartTime" column="REQUEST_START_TIME"/>
		<result property="requestEndTime" column="REQUEST_END_TIME"/>
		<result property="cargoName" column="CARGO_NAME"/>
		<result property="cargoType" column="CARGO_TYPE"/>
		<result property="cargoWeight" column="CARGO_WEIGHT"/>
		<result property="cargoCubage" column="CARGO_CUBAGE"/>
		<result property="remark" column="REMARK"/>
		<result property="contactName" column="CONTACT_NAME"/>
		<result property="companyId" column="COMPANY_ID"/>
		<result property="companyName" column="COMPANY_NAME"/>
		<result property="contactMobilephone" column="CONTACT_MOBILEPHONE"/>
		<result property="contactTelephone" column="CONTACT_TELEPHONE"/>
		<result property="collectNum" column="COLLECT_NUM"/>
		<result property="assessGoneNum" column="ASSESS_GONE_NUM"/>
		<result property="assessExistNum" column="ASSESS_EXIST_NUM"/>
	</resultMap>
	<!-- 附近货源 -->
	<select id="selectNearByCargoList" parameterType="map" resultMap="OrderCargoInfoDomain">
		SELECT
			ID,
			START_PROVINCE,
			START_CITY,
			START_COUNTY,
			START_TOWN,
			END_PROVINCE,
			END_CITY,
			END_COUNTY,
			END_TOWN,
			CARGO_TYPE,
			CARGO_NAME,
			CARGO_WEIGHT,
			CARGO_CUBAGE,
			REQUEST_CAR_PLATE_TYPE,
			REQUEST_CAR_LENGTH,
			REQUEST_START_TIME,
			CONTACT_MOBILEPHONE,
			CONTACT_TELEPHONE
		FROM
			t_order_cargo_info
		WHERE
			START_PROVINCE = #{startProvince}
		AND
			START_CITY = #{startCity}
		AND DELETED_FLAG = 0
		AND CARGO_FLAG = 0
		AND REQUEST_START_TIME <![CDATA[>=]]> DATE_FORMAT(SYSDATE(),'%Y-%m-%d')
		ORDER BY REQUEST_START_TIME ASC,CREATE_TIME DESC
		LIMIT ${fromSize},${listSize}
	</select>
	<!-- 符合预约的货源 -->
	<select id="selectCargoSuitOrderList" parameterType="map" resultMap="OrderCargoInfoDomainOther">
		SELECT
			t.ID,t.START_PROVINCE,t.START_CITY,t.START_COUNTY,t.START_TOWN,t.END_PROVINCE,t.END_CITY,
			t.END_COUNTY,t.END_TOWN,t.CARGO_TYPE,t.CARGO_NAME,
			t.REQUEST_CAR_PLATE_TYPE,t.REQUEST_CAR_LENGTH,t.REQUEST_START_TIME,t.CONTACT_MOBILEPHONE,
			t.CARGO_CUBAGE,t.CARGO_WEIGHT,t.CONTACT_TELEPHONE
		FROM t_order_cargo_info t where
		((t.START_PROVINCE = #{startProvice1} and t.START_CITY = #{startCity1} and t.END_PROVINCE = #{endProvince1}
			and t.END_CITY = #{endCity1} and t.REQUEST_START_TIME <![CDATA[<=]]> DATE_FORMAT(#{startTime1},'%Y-%m-%d'))
		OR
	  		(t.START_PROVINCE = #{startProvice2} and t.START_CITY = #{startCity2} and t.END_PROVINCE = #{endProvince2}
			and t.END_CITY = #{endCity2} and t.REQUEST_START_TIME <![CDATA[<=]]> DATE_FORMAT(#{startTime2},'%Y-%m-%d'))
		OR
            (t.START_PROVINCE = #{startProvice3} and t.START_CITY = #{startCity3} and t.END_PROVINCE = #{endProvince3}
             and t.END_CITY = #{endCity3} and t.REQUEST_START_TIME <![CDATA[<=]]> DATE_FORMAT(#{startTime3},'%Y-%m-%d')) )
		AND t.CARGO_FLAG = 0
		AND t.DELETED_FLAG = 0
		AND t.REQUEST_START_TIME <![CDATA[>=]]> DATE_FORMAT(SYSDATE(),'%Y-%m-%d')
		ORDER BY t.REQUEST_START_TIME ASC,t.CREATE_TIME DESC
		limit ${fromSize},${listSize}
	</select>

	<!-- 根据司机线路查找货源 -->
	<select id="selectCargoListByDriverLine" parameterType="map" resultMap="OrderCargoInfoDomainOther">
			SELECT
				cargo.ID,cargo.START_PROVINCE,cargo.START_CITY,cargo.START_COUNTY,cargo.START_TOWN,cargo.END_PROVINCE,cargo.END_CITY,
				cargo.END_COUNTY,cargo.END_TOWN,cargo.CARGO_TYPE,
				cargo.CARGO_NAME,cargo.CARGO_WEIGHT,cargo.CARGO_CUBAGE,cargo.REQUEST_CAR_PLATE_TYPE,cargo.REQUEST_CAR_LENGTH,
				cargo.REQUEST_START_TIME,cargo.CONTACT_MOBILEPHONE,cargo.CONTACT_TELEPHONE
			FROM t_order_cargo_info cargo where
				((cargo.START_PROVINCE = #{startProvice1}
				and cargo.START_CITY = #{startCity1}
				and cargo.END_PROVINCE = #{endProvince1}
				and cargo.END_CITY = #{endCity1})
			OR
		  		(cargo.START_PROVINCE = #{startProvice2}
		  		and cargo.START_CITY = #{startCity2}
				and cargo.END_PROVINCE = #{endProvince2}
				and cargo.END_CITY = #{endCity2})
			OR
				(cargo.START_PROVINCE = #{startProvice3}
				and cargo.START_CITY = #{startCity3}
				and cargo.END_PROVINCE = #{endProvince3}
				and cargo.END_CITY = #{endCity3}) )
			AND cargo.CARGO_FLAG = 0
			AND cargo.DELETED_FLAG = 0
			AND cargo.REQUEST_START_TIME <![CDATA[>=]]> DATE_FORMAT(SYSDATE(),'%Y-%m-%d')
			ORDER BY
			cargo.REQUEST_START_TIME ASC,cargo.CREATE_TIME DESC
			limit ${fromSize},${listSize}
	</select>

	<!-- 查找货源 -->
	<select id="selectCargoList" parameterType="map" resultMap="OrderCargoInfoDomain">
		SELECT
			cargo.ID,
			cargo.START_PROVINCE,
			cargo.START_CITY,
			cargo.START_COUNTY,
			cargo.START_TOWN,
			cargo.END_PROVINCE,
			cargo.END_CITY,
			cargo.END_COUNTY,
			cargo.END_TOWN,
			cargo.CARGO_TYPE,
			cargo.CARGO_NAME,
			cargo.CARGO_WEIGHT,
			cargo.CARGO_CUBAGE,
			cargo.REQUEST_CAR_PLATE_TYPE,
			cargo.REQUEST_CAR_LENGTH,
			cargo.REQUEST_START_TIME,
			cargo.CONTACT_MOBILEPHONE,
			cargo.CONTACT_TELEPHONE
		FROM
			t_order_cargo_info cargo
		WHERE
			cargo.DELETED_FLAG = 0
		AND cargo.CARGO_FLAG = 0
		AND cargo.REQUEST_START_TIME <![CDATA[>=]]> DATE_FORMAT(SYSDATE(),'%Y-%m-%d')
		<if test="ids != null and ids.size() > 0">
			AND cargo.id NOT IN
			<foreach collection="ids" open="(" close=")" index="index" item="e" separator=",">
				#{e}
			</foreach>
		</if>
        <if test="startTime != null and startTime != ''">
            AND cargo.REQUEST_START_TIME <![CDATA[>=]]> DATE_FORMAT(#{startTime}, '%Y-%m-%d')
        </if>
        <if test="endTime != null and endTime != ''">
            AND cargo.REQUEST_START_TIME <![CDATA[<=]]> DATE_FORMAT(#{endTime}, '%Y-%m-%d')
        </if>
        <if test="startProvince != null and startProvince != ''">
            AND cargo.START_PROVINCE = #{startProvince}
        </if>
        <if test="endProvince != null and endProvince != ''">
            AND cargo.END_PROVINCE = #{endProvince}
        </if>
        <if test="startCity != null and startCity != ''">
            AND cargo.START_CITY = #{startCity}
        </if>
        <if test="endCity != null and endCity != ''">
            AND cargo.END_CITY = #{endCity}
        </if>
        <if test="carType != null and carType != ''">
            AND (cargo.REQUEST_CAR_BAR_TYPE = #{carType} or cargo.request_car_plate_type = #{carType})
        </if>
        <if test="carLength != null and carLength != ''">
            AND REPLACE (cargo.REQUEST_CAR_LENGTH,' ','') = #{carLength}
        </if>
		<if test="minCarLength != null and minCarLength != ''">
			and REPLACE(cargo.REQUEST_CAR_LENGTH, '米', '') &gt;= REPLACE(#{minCarLength}, '米', '') + 0
		</if>
		<if test="maxCarLength != null and maxCarLength != ''">
			and REPLACE(cargo.REQUEST_CAR_LENGTH, '米', '') &lt;= REPLACE(#{maxCarLength}, '米', '') + 0
		</if>
		<if test="minLoad != null and minLoad != ''">
			and cargo.CARGO_WEIGHT &gt;= #{minLoad}
		</if>
		<if test="maxLoad != null and maxLoad != ''">
			and cargo.CARGO_WEIGHT &lt;= #{maxLoad}
		</if>
        <if test="companyName != null and companyName != ''">
            AND cargo.COMPANY_ID IN
            (select ID from t_company_info where COMPANY_NAME LIKE CONCAT('%',#{companyName},'%'))
        </if>
		ORDER BY cargo.REQUEST_START_TIME ASC,cargo.CREATE_TIME DESC
		LIMIT ${fromSize},${listSize}
	</select>
	<!-- 根据司机线路查找符合条件的货物数量 -->
	<select id="selectCargoNumByDriverLine" parameterType="map" resultType="integer">
		SELECT
				count(cargo.ID)
		FROM t_order_cargo_info cargo where
			((cargo.START_PROVINCE = #{startProvice1}
			and cargo.START_CITY = #{startCity1}
			and cargo.END_PROVINCE = #{endProvince1}
			and cargo.END_CITY = #{endCity1})
		OR
	  		(cargo.START_PROVINCE = #{startProvice2}
	  		and cargo.START_CITY = #{startCity2}
			and cargo.END_PROVINCE = #{endProvince2}
			and cargo.END_CITY = #{endCity2})
		OR
			(cargo.START_PROVINCE = #{startProvice3}
			and cargo.START_CITY = #{startCity3}
			and cargo.END_PROVINCE = #{endProvince3}
			and cargo.END_CITY = #{endCity3}) )
		AND cargo.CARGO_FLAG = 0
		AND cargo.REQUEST_START_TIME <![CDATA[>=]]> DATE_FORMAT(SYSDATE(),'%Y-%m-%d')
		AND cargo.DELETED_FLAG = 0
	</select>
	<!-- 货源详情 -->
	<select id="selectCargoDetailById" parameterType="string" resultMap="OrderCargoInfoDomainDetail">
		SELECT
			cargo.ID,
			cargo.START_PROVINCE,
			cargo.START_CITY,
			cargo.START_COUNTY,
			cargo.START_TOWN,
			cargo.END_PROVINCE,
			cargo.END_CITY,
			cargo.END_COUNTY,
			cargo.END_TOWN,
			cargo.REQUEST_START_TIME,
			cargo.REQUEST_END_TIME,
			cargo.CARGO_NAME,
			cargo.CARGO_TYPE,
			cargo.CARGO_WEIGHT,
			cargo.CARGO_CUBAGE,
			cargo.REMARK,
			cargo.CONTACT_NAME,
			cargo.COMPANY_ID,
			cargo.COMPANY_NAME,
			cargo.CONTACT_MOBILEPHONE,
			cargo.CONTACT_TELEPHONE,
			(select count(c.ID) from t_driver_cargo_collect_info c where c.CARGO_ID = cargo.ID) COLLECT_NUM,
			(select count(a.ID) from t_driver_cargo_assess_info a where a.CARGO_ID = cargo.ID and a.TYPE = 0) ASSESS_GONE_NUM,
			(select count(a.ID) from t_driver_cargo_assess_info a where a.CARGO_ID = cargo.ID and a.TYPE = 1) ASSESS_EXIST_NUM
		FROM
			t_order_cargo_info cargo
		WHERE
			cargo.ID = #{id}
	</select>

    <!-- 新增货源关注 -->
    <insert id="attentionCargoInfo" parameterType="DriverCargoCollectInfoBo" useGeneratedKeys="true" keyProperty="id">
        insert into t_driver_cargo_collect_info
        (DRIVER_ID,CARGO_ID,CREATE_TIME)
        values
        (#{driverId},#{cargoId},sysdate())
    </insert>

    <!-- 是否已关注 -->
    <select id="cargoIsAttention" parameterType="map" resultType="integer">
        select count(ID) from t_driver_cargo_collect_info where DRIVER_ID = #{driverId} and CARGO_ID = #{cargoId}
    </select>

    <!-- 新增货源点评 -->
    <insert id="commentCargoInfo" parameterType="DriverCargoAssessInfoBo" keyProperty="id" useGeneratedKeys="true">
        insert into t_driver_cargo_assess_info
        (DRIVER_ID,CARGO_ID,TYPE,ASSESS_INFO,CREATE_TIME)
        values
        (#{driverId},#{cargoId},#{type},#{assessInfo},sysdate())
    </insert>

    <!-- 校验货源是否已经评价 -->
    <select id="selectByDriverAndCargoId" parameterType="map" resultType="integer">
        select count(ID) from t_driver_cargo_assess_info where DRIVER_ID = #{driverId} and CARGO_ID = #{cargoId}
    </select>

    <!-- 修改评价 -->
    <update id="updateAssess" parameterType="DriverCargoAssessInfoBo">
        update t_driver_cargo_assess_info set TYPE = #{type}
        <if test="assessInfo != null and assessInfo != ''">
            ,ASSESS_INFO = #{assessInfo}
        </if>
        where DRIVER_ID = #{driverId} and CARGO_ID = #{cargoId}
    </update>


	<!-- 修改货源 -->
	<update id="updateCargoInfo" parameterType="map">
		update t_order_cargo_info set MODIFY_TIME = sysdate()
        <if test="cargoFlag != null and cargoFlag != ''">
            ,CARGO_FLAG = #{cargoFlag}
        </if>
        <if test="contactName != null and contactName != ''">
            ,CONTACT_NAME = #{contactName}
        </if>
        <if test="contactTelephone != null and contactTelephone != ''">
            ,CONTACT_MOBILEPHONE = #{contactTelephone}
        </if>
        <if test="contactName != null and contactName != ''">
            ,REQUEST_START_TIME = DATE_FORMAT(#{requestStartTime},'%Y-%m-%d %H:%i:%s')
        </if>
		where ID =
		(select CARGO_ID from t_transaction_info where ID = #{id})
	</update>

	<!-- 附近货源提醒 -->
	<select id="selectNearByCargoRemid" parameterType="map" resultType="java.util.HashMap">
		SELECT count(ID) nearByNum,DATE_FORMAT(max(MODIFY_TIME),'%Y-%m-%d %H:%i:%s') nearByTime
		FROM
			t_order_cargo_info
		WHERE
			START_PROVINCE = #{startProvince}
		AND
			START_CITY = #{startCity}
		AND DELETED_FLAG = 0
		AND CARGO_FLAG = 0
        <if test="nearByModifyTime != null and nearByModifyTime != ''">
            and MODIFY_TIME <![CDATA[>]]> DATE_FORMAT(#{nearByModifyTime},'%Y-%m-%d %H:%i:%s')
        </if>
		AND REQUEST_START_TIME <![CDATA[>=]]> DATE_FORMAT(SYSDATE(),'%Y-%m-%d')
	</select>

	<!-- 预约货源提醒 -->
	<select id="selectBusinesslineCargoRemid" parameterType="map" resultType="java.util.HashMap">
		SELECT count(t.ID) businesslineNum,DATE_FORMAT(max(t.MODIFY_TIME),'%Y-%m-%d %H:%i:%s') businesslineTime
		FROM
			t_order_cargo_info t
		WHERE
			((t.START_PROVINCE = #{startProvice1} and t.START_CITY = #{startCity1} and t.END_PROVINCE = #{endProvince1}
				and t.END_CITY = #{endCity1} and t.REQUEST_START_TIME <![CDATA[<=]]> DATE_FORMAT(#{startTime1},'%Y-%m-%d')
				and t.REQUEST_END_TIME <![CDATA[>=]]> DATE_FORMAT(#{endTime1},'%Y-%m-%d'))
			OR
		  		(t.START_PROVINCE = #{startProvice2} and t.START_CITY = #{startCity2} and t.END_PROVINCE = #{endProvince2}
				and t.END_CITY = #{endCity2} and t.REQUEST_START_TIME <![CDATA[<=]]> DATE_FORMAT(#{startTime2},'%Y-%m-%d')
				and t.REQUEST_END_TIME <![CDATA[>=]]> DATE_FORMAT(#{endTime2},'%Y-%m-%d'))
			OR
				(t.START_PROVINCE = #{startProvice3} and t.START_CITY = #{startCity3} and t.END_PROVINCE = #{endProvince3}
				and t.END_CITY = #{endCity3} and t.REQUEST_START_TIME <![CDATA[<=]]> DATE_FORMAT(#{startTime3},'%Y-%m-%d')
				and t.REQUEST_END_TIME <![CDATA[>=]]> DATE_FORMAT(#{endTime3},'%Y-%m-%d')) )
			AND t.MODIFY_TIME <![CDATA[>]]> DATE_FORMAT(#{businesslineModifyTime},'%Y-%m-%d %H:%i:%s')
			AND t.CARGO_FLAG = 0
			AND t.DELETED_FLAG = 0
			AND t.REQUEST_START_TIME <![CDATA[>=]]> DATE_FORMAT(SYSDATE(),'%Y-%m-%d')
	</select>

	<!-- 需要货源提醒 -->
	<select id="selectNeededCargoRemid" parameterType="map" resultType="java.util.HashMap">
		SELECT
			count(cargo.ID) driverLineNum,DATE_FORMAT(max(cargo.MODIFY_TIME),'%Y-%m-%d %H:%i:%s') driverLineTime
		FROM  t_order_cargo_info cargo
		WHERE
			((cargo.START_PROVINCE = #{startProvice1}
			and cargo.START_CITY = #{startCity1}
			and cargo.END_PROVINCE = #{endProvince1}
			and cargo.END_CITY = #{endCity1})
		OR
	  		(cargo.START_PROVINCE = #{startProvice2}
	  		and cargo.START_CITY = #{startCity2}
			and cargo.END_PROVINCE = #{endProvince2}
			and cargo.END_CITY = #{endCity2})
		OR
			(cargo.START_PROVINCE = #{startProvice3}
			and cargo.START_CITY = #{startCity3}
			and cargo.END_PROVINCE = #{endProvince3}
			and cargo.END_CITY = #{endCity3}) )
		AND cargo.MODIFY_TIME <![CDATA[>]]> DATE_FORMAT(#{driverLineModifyTime},'%Y-%m-%d %H:%i:%s')
		AND cargo.CARGO_FLAG = 0
		AND cargo.DELETED_FLAG = 0
		AND cargo.REQUEST_START_TIME <![CDATA[>=]]> DATE_FORMAT(SYSDATE(),'%Y-%m-%d')
	</select>

    <!-- 某条货源被多少次标注为货已走 -->
    <select id="selectDriverCargoAssessNum" parameterType="string" resultType="integer">
        select count(ID) from t_driver_cargo_assess_info where TYPE = 0 and CARGO_ID = #{cargoId}
    </select>

	<!-- 根据司机当前位置和运营线路找货 -->
	<select id="queryCargoByLines" parameterType="hashmap" resultMap="OrderCargoInfoDomain">
		SELECT
		cargo.*
		FROM
		t_order_cargo_info cargo
		WHERE
		cargo.DELETED_FLAG = 0
		AND cargo.CARGO_FLAG = 0
		AND cargo.REQUEST_START_TIME <![CDATA[>=]]> DATE_FORMAT(SYSDATE(),'%Y-%m-%d')
		<if test="ids != null and ids.size() > 0">
			and cargo.id not in
			<foreach collection="ids" separator="," item="e" index="index" open="(" close=")">
				#{e}
			</foreach>
		</if>
		<if test="minCarLength != null and minCarLength != ''">
			and REPLACE(cargo.REQUEST_CAR_LENGTH, '米', '') &gt;= REPLACE(#{minCarLength}, '米', '') + 0
		</if>
		<if test="maxCarLength != null and maxCarLength != ''">
			and REPLACE(cargo.REQUEST_CAR_LENGTH, '米', '') &lt;= REPLACE(#{maxCarLength}, '米', '') + 0
		</if>
		<if test="minLoad != null and minLoad != ''">
			and cargo.CARGO_WEIGHT &gt;= #{minLoad}
		</if>
		<if test="maxLoad != null and maxLoad != ''">
			and cargo.CARGO_WEIGHT &lt;= #{maxLoad}
		</if>
		<if test="startProvince != null and startProvince != ''">
			AND cargo.START_PROVINCE = #{startProvince}
		</if>
		<if test="startCity != null and startCity != ''">
			AND cargo.START_CITY = #{startCity}
		</if>
		<if test="provinces != null and provinces.size() > 0">
			AND cargo.END_PROVINCE in
			<foreach collection="provinces" close=")" open="(" index="index" item="e" separator=",">
				#{e}
			</foreach>
		</if>
		<if test="cities != null and cities.size() > 0">
			AND cargo.END_CITY in
			<foreach collection="cities" close=")" open="(" index="index" item="e" separator=",">
				#{e}
			</foreach>
		</if>
		ORDER BY cargo.REQUEST_START_TIME ASC,cargo.CREATE_TIME DESC
	</select>

	<!-- 查询未被查到的附近货源 -->
	<select id="queryCargoLocationAndNotExistIn" parameterType="hashmap" resultMap="OrderCargoInfoDomain">
		SELECT
			*
		FROM
		t_order_cargo_info
		WHERE
		START_PROVINCE = #{startProvince}
		AND
		START_CITY = #{startCity}
		<if test="ids != null and ids.size() > 0">
			and id not in
			<foreach collection="ids" separator="," item="e" index="index" open="(" close=")">
				#{e}
			</foreach>
		</if>
		<if test="minCarLength != null and minCarLength != ''">
			and REPLACE(REQUEST_CAR_LENGTH, '米', '') &gt;= REPLACE(#{minCarLength}, '米', '') + 0
		</if>
		<if test="maxCarLength != null and maxCarLength != ''">
			and REPLACE(REQUEST_CAR_LENGTH, '米', '') &lt;= REPLACE(#{maxCarLength}, '米', '') + 0
		</if>
		<if test="minLoad != null and minLoad != ''">
			and CARGO_WEIGHT &gt;= #{minLoad}
		</if>
		<if test="maxLoad != null and maxLoad != ''">
			and CARGO_WEIGHT &lt;= #{maxLoad}
		</if>
		AND DELETED_FLAG = 0
		AND CARGO_FLAG = 0
		AND REQUEST_START_TIME <![CDATA[>=]]> DATE_FORMAT(SYSDATE(),'%Y-%m-%d')
		ORDER BY REQUEST_START_TIME ASC,CREATE_TIME DESC
		LIMIT ${offSet}
	</select>
</mapper>