<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap   
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"   
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="com.cy.xtgl.dao.BusQyXtCsMapper">
	<select id="selectQyXtCsPage" parameterClass="java.util.Map"
		resultClass="com.cy.xtgl.domain.QyXtCsDomain">
	SELECT JGBM AS jgbm,
	(CASE WHEN JGBM = '0' THEN #xtgg# ELSE (SELECT
	DM.MC FROM QY_ZZJG DM WHERE DM.JGBM = T.JGBM) END) AS dwmc,
	JBDM AS jgdm,
	CSXH AS csxh,
	CSLB_DM AS cslbDm,
	CSMC AS csmc,
	SYSM AS sysm,
	SJXLB_DM AS sjxlbDm,
	XZXM_DM AS xzxmDm,
	CSZ AS csz 
	FROM (SELECT
	JGBM,JBDM,CSXH,CSLB_DM,CSMC,SYSM,SJXLB_DM,XZXM_DM,CSZ,
	ROW_NUMBER() OVER(PARTITION BY CSXH ORDER BY JBDM DESC) RN
	FROM (SELECT 0 JGBM,'0' JBDM,A.CSXH,A.CSLB_DM,A.CSMC,A.SYSM,A.SJXLB_DM,A.XZXM_DM,
	(CASE WHEN (A.SJXLB_DM = '21' OR A.SJXLB_DM = '23') THEN
	(SELECT DM.XZXM_VALUE_DM || ' ' || DM.XZXM_VALUE_MC FROM DM_XZXM DM WHERE
	DM.XZXM_DM = A.XZXM_DM AND A.CSMRZ = DM.XZXM_VALUE_DM)
	ELSE A.CSMRZ END) CSZ
	FROM XT_XTCS A
	WHERE A.CSLB_DM = '2'
	AND A.YXBZ = 'Y'
	UNION ALL
	SELECT DM.JGBM,DM.JBDM,B.CSXH,B.CSLB_DM,B.CSMC,B.SYSM,B.SJXLB_DM,B.XZXM_DM,
	(CASE WHEN (B.SJXLB_DM = '21' OR B.SJXLB_DM = '23') THEN
	(SELECT DM.XZXM_VALUE_DM || ' ' || DM.XZXM_VALUE_MC FROM DM_XZXM DM WHERE
	DM.XZXM_DM = B.XZXM_DM AND A.CSZ = DM.XZXM_VALUE_DM)
	ELSE A.CSZ END) CSZ
	FROM XT_XTCS_SZXX A,XT_XTCS B,QY_ZZJG DM,QY_ZZJG JG
	WHERE B.CSLB_DM = '2'
	AND A.CSXH = B.CSXH
	AND B.YXBZ = 'Y'
	AND A.SZDW = DM.JGBM
		<dynamic> 
			<isNotEmpty property="ssJgbm" prepend="and">
				JG.JGBM =#ssJgbm#
			</isNotEmpty>
	</dynamic>		
	AND JG.JBDM LIKE DM.JBDM || '%')) T
	WHERE RN = 1
	$orderStr$
	</select>
	
	<select id="selectQyXtCsAll" parameterClass="java.util.Map"
		resultClass="com.cy.xtgl.domain.QyXtCsDomain">
	SELECT JGBM AS jgbm,
	(CASE WHEN JGBM = '0' THEN #xtgg# ELSE (SELECT
	DM.MC FROM QY_ZZJG DM WHERE DM.JGBM = T.JGBM) END) AS dwmc,
	JBDM AS jgdm,
	CSXH AS csxh,
	CSLB_DM AS cslbDm,
	CSMC AS csmc,
	SYSM AS sysm,
	SJXLB_DM AS sjxlbDm,
	XZXM_DM AS xzxmDm,
	CSZ AS csz 
	FROM (SELECT
	JGBM,JBDM,CSXH,CSLB_DM,CSMC,SYSM,SJXLB_DM,XZXM_DM,CSZ,
	ROW_NUMBER() OVER(PARTITION BY CSXH ORDER BY JBDM DESC) RN
	FROM (SELECT 0 JGBM,'0' JBDM,A.CSXH,A.CSLB_DM,A.CSMC,A.SYSM,A.SJXLB_DM,A.XZXM_DM,
	(CASE WHEN (A.SJXLB_DM = '21' OR A.SJXLB_DM = '23') THEN
	(SELECT DM.XZXM_VALUE_DM || ' ' || DM.XZXM_VALUE_MC FROM DM_XZXM DM WHERE
	DM.XZXM_DM = A.XZXM_DM AND A.CSMRZ = DM.XZXM_VALUE_DM)
	ELSE A.CSMRZ END) CSZ
	FROM XT_XTCS A
	WHERE A.CSLB_DM = '2'
	AND A.YXBZ = 'Y'
	UNION ALL
	SELECT DM.JGBM,DM.JBDM,B.CSXH,B.CSLB_DM,B.CSMC,B.SYSM,B.SJXLB_DM,B.XZXM_DM,
	(CASE WHEN (B.SJXLB_DM = '21' OR B.SJXLB_DM = '23') THEN
	(SELECT DM.XZXM_VALUE_DM || ' ' || DM.XZXM_VALUE_MC FROM DM_XZXM DM WHERE
	DM.XZXM_DM = B.XZXM_DM AND A.CSZ = DM.XZXM_VALUE_DM)
	ELSE A.CSZ END) CSZ
	FROM XT_XTCS_SZXX A,XT_XTCS B,QY_ZZJG DM,QY_ZZJG JG
	WHERE B.CSLB_DM = '2'
	AND A.CSXH = B.CSXH
	AND B.YXBZ = 'Y'
	AND A.SZDW = DM.JGBM
	<dynamic> 
			<isNotEmpty property="ssJgbm" prepend="and">
				JG.JGBM =#ssJgbm#
			</isNotEmpty>
	</dynamic>	
	AND JG.JBDM LIKE DM.JBDM || '%')) T
	WHERE RN = 1
	ORDER BY CSXH
	</select>
	
	<select id="getQyXtCsRowCount" parameterClass="java.util.Map"
		resultClass="java.lang.Integer">
	SELECT COUNT(CSXH)
	FROM (SELECT
	JGBM,JBDM,CSXH,CSLB_DM,CSMC,SYSM,SJXLB_DM,XZXM_DM,CSZ,
	ROW_NUMBER() OVER(PARTITION BY CSXH ORDER BY JBDM DESC) RN
	FROM (SELECT 0 JGBM,'0' JBDM,A.CSXH,A.CSLB_DM,A.CSMC,A.SYSM,A.SJXLB_DM,A.XZXM_DM,
	(CASE WHEN (A.SJXLB_DM = '21' OR A.SJXLB_DM = '23') THEN
	(SELECT DM.XZXM_VALUE_DM || ' ' || DM.XZXM_VALUE_MC FROM DM_XZXM DM WHERE
	DM.XZXM_DM = A.XZXM_DM AND A.CSMRZ = DM.XZXM_VALUE_DM)
	ELSE A.CSMRZ END) CSZ
	FROM XT_XTCS A
	WHERE A.CSLB_DM = '2'
	AND A.YXBZ = 'Y'
	UNION ALL
	SELECT DM.JGBM,DM.JBDM,B.CSXH,B.CSLB_DM,B.CSMC,B.SYSM,B.SJXLB_DM,B.XZXM_DM,
	(CASE WHEN (B.SJXLB_DM = '21' OR B.SJXLB_DM = '23') THEN
	(SELECT DM.XZXM_VALUE_DM || ' ' || DM.XZXM_VALUE_MC FROM DM_XZXM DM WHERE
	DM.XZXM_DM = B.XZXM_DM AND A.CSZ = DM.XZXM_VALUE_DM)
	ELSE A.CSZ END) CSZ
	FROM XT_XTCS_SZXX A,XT_XTCS B,QY_ZZJG DM,QY_ZZJG JG
	WHERE B.CSLB_DM = '2'
	AND A.CSXH = B.CSXH
	AND B.YXBZ = 'Y'
	AND A.SZDW = DM.JGBM
	<dynamic>
		<isNotEmpty property="ssJgbm" prepend="and">
			JG.JGBM =#ssJgbm#
		</isNotEmpty>
	</dynamic>
	AND JG.JBDM LIKE DM.JBDM || '%'))
	WHERE RN = 1
    </select>
    
    <select id="selectQyXtCsByProperty" parameterClass="java.util.Map"
		resultClass="com.cy.xtgl.domain.QyXtCsDomain">
	SELECT JGBM AS jgbm,
	(CASE WHEN JGBM = '0' THEN #xtgg# ELSE (SELECT
	DM.MC FROM QY_ZZJG DM WHERE DM.JGBM = T.JGBM) END) AS dwmc,
	JBDM AS jgdm,
	CSXH AS csxh,
	CSLB_DM AS cslbDm,
	CSMC AS csmc,
	SYSM AS sysm,
	SJXLB_DM AS sjxlbDm,
	XZXM_DM AS xzxmDm,
	CSZ AS csz 
	FROM (SELECT
	JGBM,JBDM,CSXH,CSLB_DM,CSMC,SYSM,SJXLB_DM,XZXM_DM,CSZ,
	ROW_NUMBER() OVER(PARTITION BY CSXH ORDER BY JBDM DESC) RN
	FROM (SELECT 0 JGBM,'0' JBDM,A.CSXH,A.CSLB_DM,A.CSMC,A.SYSM,A.SJXLB_DM,A.XZXM_DM,
	(CASE WHEN (A.SJXLB_DM = '21' OR A.SJXLB_DM = '23') THEN
	(SELECT DM.XZXM_VALUE_DM || ' ' || DM.XZXM_VALUE_MC FROM DM_XZXM DM WHERE
	DM.XZXM_DM = A.XZXM_DM AND A.CSMRZ = DM.XZXM_VALUE_DM)
	ELSE A.CSMRZ END) CSZ
	FROM XT_XTCS A
	WHERE A.CSLB_DM = '2'
	AND A.YXBZ = 'Y'
	UNION ALL
	SELECT DM.JGBM,DM.JBDM,B.CSXH,B.CSLB_DM,B.CSMC,B.SYSM,B.SJXLB_DM,B.XZXM_DM,
	(CASE WHEN (B.SJXLB_DM = '21' OR B.SJXLB_DM = '23') THEN
	(SELECT DM.XZXM_VALUE_DM || ' ' || DM.XZXM_VALUE_MC FROM DM_XZXM DM WHERE
	DM.XZXM_DM = B.XZXM_DM AND A.CSZ = DM.XZXM_VALUE_DM)
	ELSE A.CSZ END) CSZ
	FROM XT_XTCS_SZXX A,XT_XTCS B,QY_ZZJG DM,QY_ZZJG JG
	WHERE B.CSLB_DM = '2'
	AND A.CSXH = B.CSXH
	AND B.YXBZ = 'Y'
	AND A.SZDW = DM.JGBM
	<dynamic> 
			<isNotEmpty property="ssJgbm" prepend="and">
				JG.JGBM =#ssJgbm#
			</isNotEmpty>
	</dynamic>	
	AND JG.JBDM LIKE DM.JBDM || '%')) T
	WHERE RN = 1
	<dynamic> 
			<isNotEmpty property="csxh" prepend="and">
				CSXH =#csxh#
			</isNotEmpty>
	</dynamic>
	</select>
	

	
</sqlMap>