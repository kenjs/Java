<?xml version="1.0" encoding="UTF-8"?>  
<!DOCTYPE sqlMap   
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"   
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="com.cy.zygl.dao.BusQykhhwxxMapper">
	<select id="selectQyKhHwxxPage" parameterClass="java.util.Map"
		resultClass="com.cy.zygl.domain.QyKhHwxxDomain">
		SELECT A.HW_DJXH AS hwDjxh,
		       A.HWMC AS hwmc,
		       A.HWJC AS hwjc,
		       A.PYQC AS pyqc,
		       A.PYJC AS pyjc,
		       A.CD_JLDW_DM AS cdJldwDm,
		       A.CD AS cd,
		       A.KD AS kd,
		       A.GD AS gd,
		       A.BZ_JLDW_DM AS bzJldwDm,
		       A.BZ_JS_HSBL AS bzJsHsbl,
		       A.BZ_CB_HSBL AS bzCbHsbl,
		       A.JS_JLDW_DM AS jsJldwDm,
		       A.CB_JLDW_DM AS cbJldwDm,
		       A.BZ AS bz,
		       A.DJ_JGBM AS djJgbm,
		       A.DJR_CZY_DJXH AS djrCzyDjxh,
		       A.DJRQ AS djrq,
		       A.QYBZ AS qybz,
		       A.YXBZ AS yxbz,
		       A.CJR_CZY_DJXH AS cjrCzyDjxh,
		       A.CJRQ AS cjrq,
		       A.XGR_CZY_DJXH AS xgrCzyDjxh,
		       A.XGRQ AS xgrq,
		       (SELECT KD.KHMC FROM QY_KH_DJXX KD WHERE KD.KH_DJXH=A.KH_DJXH) AS khmc,
		       (SELECT RY.MC from QY_RYDJ RY WHERE RY.CZY_DJXH=A.CJR_CZY_DJXH) cjrMc,
		       (SELECT RY.MC from QY_RYDJ RY WHERE RY.CZY_DJXH=A.XGR_CZY_DJXH) xgrMc,
		       (SELECT DW.JLDW_MC FROM DM_JLDW DW WHERE DW.JLDW_DM=CD_JLDW_DM) cdJldwMc,
			    (SELECT DW.JLDW_MC FROM DM_JLDW DW WHERE DW.JLDW_DM=BZ_JLDW_DM) bzJldwMc,
			    (SELECT DW.JLDW_FL_MC FROM DM_JLDW_FL DW WHERE DW.JLDW_FL_DM=JS_JLDW_DM) jsJldwMc,
			    (SELECT DW.JLDW_MC FROM DM_JLDW DW WHERE DW.JLDW_DM=CB_JLDW_DM) cbJldwMc,
			    A.SL_JLDW_DM AS slJldwDm,
		      (SELECT JLDW_JC FROM DM_JLDW DM WHERE JLDW_FL_DM = '01' AND DM.JLDW_DM = A.SL_JLDW_DM) sl,
		       A.ZL_JLDW_DM AS zlJldwDm,
		        (SELECT JLDW_JC FROM DM_JLDW DM WHERE JLDW_FL_DM = '02' AND DM.JLDW_DM = A.ZL_JLDW_DM) zl,
		       A.TJ_JLDW_DM AS tjJldwDm,
		        (SELECT JLDW_JC FROM DM_JLDW DM WHERE JLDW_FL_DM = '03' AND DM.JLDW_DM = A.TJ_JLDW_DM) tj
		  FROM QY_KH_HWXX A 
		  WHERE A.YXBZ='Y' 
		  <dynamic> 
			<isNotEmpty property="ssJgbm" prepend="and">
				A.SS_JGBM =#ssJgbm#
			</isNotEmpty>
			<isNotEmpty property="khDjxh" prepend="and">
				A.KH_DJXH =#khDjxh#
			</isNotEmpty>
			<isNotEmpty property="djJgbm" prepend="and">
				A.DJ_JGBM = #djJgbm#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="djxh">
				A.KH_DJXH IN ($djxh$)
			</isNotEmpty>
		  </dynamic>
		   $orderStr$
    </select>
    
    <select id="selectQyKhHwxxAll" parameterClass="java.util.Map"
		resultClass="com.cy.zygl.domain.QyKhHwxxDomain">
		SELECT A.HW_DJXH AS hwDjxh,
		       A.HWMC AS hwmc,
		       A.HWJC AS hwjc,
		       A.PYQC AS pyqc,
		       A.PYJC AS pyjc,
		       A.CD_JLDW_DM AS cdJldwDm,
		       A.CD AS cd,
		       A.KD AS kd,
		       A.GD AS gd,
		       A.BZ_JLDW_DM AS bzJldwDm,
		       A.BZ_JS_HSBL AS bzJsHsbl,
		       A.BZ_CB_HSBL AS bzCbHsbl,
		       A.JS_JLDW_DM AS jsJldwDm,
		       A.CB_JLDW_DM AS cbJldwDm,
		       A.BZ AS bz,
		       A.DJ_JGBM AS djJgbm,
		       A.DJR_CZY_DJXH AS djrCzyDjxh,
		       A.DJRQ AS djrq,
		       A.QYBZ AS qybz,
		       A.YXBZ AS yxbz,
		       A.CJR_CZY_DJXH AS cjrCzyDjxh,
		       A.CJRQ AS cjrq,
		       A.XGR_CZY_DJXH AS xgrCzyDjxh,
		       A.XGRQ AS xgrq,
		       (SELECT KD.KHMC FROM QY_KH_DJXX KD WHERE KD.KH_DJXH=A.KH_DJXH) AS khmc,
		       (SELECT RY.MC from QY_RYDJ RY WHERE RY.CZY_DJXH=A.CJR_CZY_DJXH) cjrMc,
		       (SELECT RY.MC from QY_RYDJ RY WHERE RY.CZY_DJXH=A.XGR_CZY_DJXH) xgrMc,
		       (SELECT DW.JLDW_MC FROM DM_JLDW DW WHERE DW.JLDW_DM=CD_JLDW_DM) cdJldwMc,
		       (SELECT DW.JLDW_MC FROM DM_JLDW DW WHERE DW.JLDW_DM=BZ_JLDW_DM) bzJldwMc,
		       (SELECT DW.JLDW_FL_MC FROM DM_JLDW_FL DW WHERE DW.JLDW_FL_DM=JS_JLDW_DM) jsJldwMc,
		       (SELECT DW.JLDW_MC FROM DM_JLDW DW WHERE DW.JLDW_DM=CB_JLDW_DM) cbJldwMc,
		       A.SL_JLDW_DM AS slJldwDm,
		      (SELECT JLDW_JC FROM DM_JLDW DM WHERE JLDW_FL_DM = '01' AND DM.JLDW_DM = A.SL_JLDW_DM) sl,
		       A.ZL_JLDW_DM AS zlJldwDm,
		        (SELECT JLDW_JC FROM DM_JLDW DM WHERE JLDW_FL_DM = '02' AND DM.JLDW_DM = A.ZL_JLDW_DM) zl,
		       A.TJ_JLDW_DM AS tjJldwDm,
		        (SELECT JLDW_JC FROM DM_JLDW DM WHERE JLDW_FL_DM = '03' AND DM.JLDW_DM = A.TJ_JLDW_DM) tj
		  FROM QY_KH_HWXX A 
		  WHERE A.YXBZ='Y' 
		  <dynamic> 
			<isNotEmpty property="ssJgbm" prepend="and">
				A.SS_JGBM =#ssJgbm#
			</isNotEmpty>
			<isNotEmpty property="khDjxh" prepend="and">
				A.KH_DJXH =#khDjxh#
			</isNotEmpty>
			<isNotEmpty property="djJgbm" prepend="and">
				A.DJ_JGBM = #djJgbm#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="djxh">
				A.KH_DJXH IN ($djxh$)
			</isNotEmpty>
		  </dynamic>
		  ORDER by A.HW_DJXH ASC
    </select>
	
	<select id="getKhjcByKhDjxh" parameterClass="java.util.Map"
		resultClass="java.lang.String">
		SELECT A.KHJC AS khjc FROM QY_KH_DJXX A WHERE A.KH_DJXH=#khDjxh#
	</select>
	
	<select id="getQyKhHwxxRowCount" parameterClass="java.util.Map"
		resultClass="java.lang.Integer">
		SELECT count(A.HW_DJXH) 
		  FROM QY_KH_HWXX A 
		  WHERE A.YXBZ='Y' 
		  <dynamic> 
			<isNotEmpty property="ssJgbm" prepend="and">
				A.SS_JGBM =#ssJgbm#
			</isNotEmpty>
			<isNotEmpty property="khDjxh" prepend="and">
				A.KH_DJXH =#khDjxh#
			</isNotEmpty>
			<isNotEmpty property="djJgbm" prepend="and">
				A.DJ_JGBM = #djJgbm#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="djxh">
				A.KH_DJXH IN ($djxh$)
			</isNotEmpty>
		  </dynamic>
    </select>
    
    <select id="getQyKhHwxxMcCount" parameterClass="java.util.Map" resultClass="java.lang.Integer">
    	select count(*) from QY_KH_HWXX where KH_DJXH = #khDjxh# and HWMC=#hwmc# and yxbz='Y'
    	<dynamic> 
			<isNotEmpty property="hwDjxh" prepend="and">
				HW_DJXH &lt;&gt; #hwDjxh#
			</isNotEmpty>
		  </dynamic>
    </select>
    
    <select id="selectQyKhDjxhByKhMc" parameterClass="java.util.Map" resultClass="com.cy.zygl.domain.QyKhHwxxDomain">
    		select kh_djxh as khDjxh from QY_KH_DJXX where khmc like #fhrMc#
    </select>
</sqlMap>